<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>typer.main &#8212; saturnin 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../../index.html">
          saturnin</a>
        <span class="navbar-text pull-left"><b>0.8.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../../usage-guide.html">Usage Guide</a></li>
                <li><a href="../../py-modindex.html">Modules</a></li>
                <li><a href="../../genindex.html">Index</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Content <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#quick-start-guide">Quick-start Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage-guide.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Saturnin Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base.html">saturnin.base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#types">Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#dataclasses">Dataclasses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-types.html">saturnin.base.types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#saturnin-common-type-definitions-and-constants">Saturnin common type definitions and constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#types-for-annotations">Types for annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#sentinels">Sentinels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#dataclasses">Dataclasses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-config.html">saturnin.base.config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-transport.html">saturnin.base.transport</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#types-for-type-hints">Types for type hints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#channels-for-individual-0mq-socket-types">Channels for individual 0MQ socket types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-component.html">saturnin.base.component</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-component.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-component.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-controller.html">saturnin.component.controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-controller.html#constants-and-variables">Constants and variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-controller.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-controller.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-micro.html">saturnin.component.micro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-micro.html#constants-and-variables">Constants and variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-micro.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-service.html">saturnin.component.service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-service.html#constants-and-variables">Constants and variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-service.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-client.html">saturnin.component.client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-client.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-single.html">saturnin.component.single</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-single.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-bundle.html">saturnin.component.bundle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-bundle.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-registry.html">saturnin.component.registry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-registry.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-registry.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-apps.html">saturnin.component.apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-apps.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-apps.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-recipe.html">saturnin.component.recipe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-recipe.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-recipe.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-recipe.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-console.html">saturnin.lib.console</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-daemon.html">saturnin.lib.daemon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-daemon.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-metadata.html">saturnin.lib.metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-metadata.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-data-onepipe.html">saturnin.lib.data.onepipe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-onepipe.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-onepipe.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-data-filter.html">saturnin.lib.data.filter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-filter.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-filter.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-protocol-fbsp.html">saturnin.protocol.fbsp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-protocol-fbdp.html">saturnin.protocol.fbdp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbdp.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbdp.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbdp.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-protocol-iccp.html">saturnin.protocol.iccp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-iccp.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-iccp.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-svcrun.html">saturnin._scripts.svcrun</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-svcrun.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-daemon.html">saturnin._scripts.daemon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-daemon.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-bundlerun.html">saturnin._scripts.bundlerun</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-bundlerun.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-cli.html">saturnin._scripts.cli</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-cli.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-cli.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-repl.html">saturnin._scripts.repl</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-repl.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-repl.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-repl.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-completers.html">saturnin._scripts.completers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-completers.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-site.html">saturnin._scripts.commands.site</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-site.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-site.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-site.html#command-functions">Command functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-site.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-pkg.html">saturnin._scripts.commands.pkg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-pkg.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-pkg.html#command-functions">Command functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-recipes.html">saturnin._scripts.commands.recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-daemons.html">saturnin._scripts.commands.daemons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-oids.html">saturnin._scripts.commands.oids</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#version-0-7-0">Version 0.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#version-0-1-0">Version 0.1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <h1>Source code for typer.main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">update_wrapper</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">FrameSummary</span><span class="p">,</span> <span class="n">StackSummary</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">import</span> <span class="nn">click</span>

<span class="kn">from</span> <span class="nn">.completion</span> <span class="kn">import</span> <span class="n">get_completion_inspect_parameters</span>
<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">MarkupMode</span><span class="p">,</span> <span class="n">TyperArgument</span><span class="p">,</span> <span class="n">TyperCommand</span><span class="p">,</span> <span class="n">TyperGroup</span><span class="p">,</span> <span class="n">TyperOption</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnyType</span><span class="p">,</span>
    <span class="n">ArgumentInfo</span><span class="p">,</span>
    <span class="n">CommandFunctionType</span><span class="p">,</span>
    <span class="n">CommandInfo</span><span class="p">,</span>
    <span class="n">Default</span><span class="p">,</span>
    <span class="n">DefaultPlaceholder</span><span class="p">,</span>
    <span class="n">DeveloperExceptionConfig</span><span class="p">,</span>
    <span class="n">FileBinaryRead</span><span class="p">,</span>
    <span class="n">FileBinaryWrite</span><span class="p">,</span>
    <span class="n">FileText</span><span class="p">,</span>
    <span class="n">FileTextWrite</span><span class="p">,</span>
    <span class="n">NoneType</span><span class="p">,</span>
    <span class="n">OptionInfo</span><span class="p">,</span>
    <span class="n">ParameterInfo</span><span class="p">,</span>
    <span class="n">ParamMeta</span><span class="p">,</span>
    <span class="n">Required</span><span class="p">,</span>
    <span class="n">TyperInfo</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">get_params_from_function</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">rich</span>
    <span class="kn">from</span> <span class="nn">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
    <span class="kn">from</span> <span class="nn">rich.traceback</span> <span class="kn">import</span> <span class="n">Traceback</span>

    <span class="n">console_stderr</span> <span class="o">=</span> <span class="n">Console</span><span class="p">(</span><span class="n">stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma: nocover</span>
    <span class="n">rich</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>

<span class="n">_original_except_hook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>
<span class="n">_typer_developer_exception_attr_name</span> <span class="o">=</span> <span class="s2">&quot;__typer_developer_exception__&quot;</span>


<span class="k">def</span> <span class="nf">except_hook</span><span class="p">(</span>
    <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span> <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="n">tb</span><span class="p">:</span> <span class="n">TracebackType</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">exception_config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeveloperExceptionConfig</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
        <span class="n">exc_value</span><span class="p">,</span> <span class="n">_typer_developer_exception_attr_name</span><span class="p">,</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">standard_traceback</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;_TYPER_STANDARD_TRACEBACK&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">standard_traceback</span>
        <span class="ow">or</span> <span class="ow">not</span> <span class="n">exception_config</span>
        <span class="ow">or</span> <span class="ow">not</span> <span class="n">exception_config</span><span class="o">.</span><span class="n">pretty_exceptions_enable</span>
    <span class="p">):</span>
        <span class="n">_original_except_hook</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">typer_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="n">click_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">click</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="n">supress_internal_dir_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">typer_path</span><span class="p">,</span> <span class="n">click_path</span><span class="p">]</span>
    <span class="n">exc</span> <span class="o">=</span> <span class="n">exc_value</span>
    <span class="k">if</span> <span class="n">rich</span><span class="p">:</span>
        <span class="n">rich_tb</span> <span class="o">=</span> <span class="n">Traceback</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
            <span class="n">exc</span><span class="p">,</span>
            <span class="n">exc</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">,</span>
            <span class="n">show_locals</span><span class="o">=</span><span class="n">exception_config</span><span class="o">.</span><span class="n">pretty_exceptions_show_locals</span><span class="p">,</span>
            <span class="n">suppress</span><span class="o">=</span><span class="n">supress_internal_dir_names</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">console_stderr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">rich_tb</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">tb_exc</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">TracebackException</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
    <span class="n">stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrameSummary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">tb_exc</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">supress_internal_dir_names</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exception_config</span><span class="o">.</span><span class="n">pretty_exceptions_short</span><span class="p">:</span>
                <span class="c1"># Hide the line for internal libraries, Typer and Click</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">FrameSummary</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                        <span class="n">lineno</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="c1"># Type ignore ref: https://github.com/python/typeshed/pull/8244</span>
    <span class="n">final_stack_summary</span> <span class="o">=</span> <span class="n">StackSummary</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">tb_exc</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">final_stack_summary</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tb_exc</span><span class="o">.</span><span class="n">format</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">get_install_completion_arguments</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">click</span><span class="o">.</span><span class="n">Parameter</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]:</span>
    <span class="n">install_param</span><span class="p">,</span> <span class="n">show_param</span> <span class="o">=</span> <span class="n">get_completion_inspect_parameters</span><span class="p">()</span>
    <span class="n">click_install_param</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_click_param</span><span class="p">(</span><span class="n">install_param</span><span class="p">)</span>
    <span class="n">click_show_param</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_click_param</span><span class="p">(</span><span class="n">show_param</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">click_install_param</span><span class="p">,</span> <span class="n">click_show_param</span>


<span class="k">class</span> <span class="nc">Typer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">TyperGroup</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">invoke_without_command</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">no_args_is_help</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">subcommand_metavar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">chain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">result_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="c1"># Command</span>
        <span class="n">context_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">epilog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">short_help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">options_metavar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="s2">&quot;[OPTIONS]&quot;</span><span class="p">),</span>
        <span class="n">add_help_option</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">hidden</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">add_completion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1"># Rich settings</span>
        <span class="n">rich_markup_mode</span><span class="p">:</span> <span class="n">MarkupMode</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rich_help_panel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">pretty_exceptions_enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pretty_exceptions_show_locals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pretty_exceptions_short</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_completion</span> <span class="o">=</span> <span class="n">add_completion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rich_markup_mode</span><span class="p">:</span> <span class="n">MarkupMode</span> <span class="o">=</span> <span class="n">rich_markup_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rich_help_panel</span> <span class="o">=</span> <span class="n">rich_help_panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions_enable</span> <span class="o">=</span> <span class="n">pretty_exceptions_enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions_show_locals</span> <span class="o">=</span> <span class="n">pretty_exceptions_show_locals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions_short</span> <span class="o">=</span> <span class="n">pretty_exceptions_short</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">TyperInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span>
            <span class="n">invoke_without_command</span><span class="o">=</span><span class="n">invoke_without_command</span><span class="p">,</span>
            <span class="n">no_args_is_help</span><span class="o">=</span><span class="n">no_args_is_help</span><span class="p">,</span>
            <span class="n">subcommand_metavar</span><span class="o">=</span><span class="n">subcommand_metavar</span><span class="p">,</span>
            <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span>
            <span class="n">result_callback</span><span class="o">=</span><span class="n">result_callback</span><span class="p">,</span>
            <span class="n">context_settings</span><span class="o">=</span><span class="n">context_settings</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">epilog</span><span class="o">=</span><span class="n">epilog</span><span class="p">,</span>
            <span class="n">short_help</span><span class="o">=</span><span class="n">short_help</span><span class="p">,</span>
            <span class="n">options_metavar</span><span class="o">=</span><span class="n">options_metavar</span><span class="p">,</span>
            <span class="n">add_help_option</span><span class="o">=</span><span class="n">add_help_option</span><span class="p">,</span>
            <span class="n">hidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span>
            <span class="n">deprecated</span><span class="o">=</span><span class="n">deprecated</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TyperInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_commands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CommandInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TyperInfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">TyperGroup</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">invoke_without_command</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">no_args_is_help</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">subcommand_metavar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">chain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">result_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="c1"># Command</span>
        <span class="n">context_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">epilog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">short_help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">options_metavar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="s2">&quot;[OPTIONS]&quot;</span><span class="p">),</span>
        <span class="n">add_help_option</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">hidden</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="c1"># Rich settings</span>
        <span class="n">rich_help_panel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CommandFunctionType</span><span class="p">],</span> <span class="n">CommandFunctionType</span><span class="p">]:</span>
        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">CommandFunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandFunctionType</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registered_callback</span> <span class="o">=</span> <span class="n">TyperInfo</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">invoke_without_command</span><span class="o">=</span><span class="n">invoke_without_command</span><span class="p">,</span>
                <span class="n">no_args_is_help</span><span class="o">=</span><span class="n">no_args_is_help</span><span class="p">,</span>
                <span class="n">subcommand_metavar</span><span class="o">=</span><span class="n">subcommand_metavar</span><span class="p">,</span>
                <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span>
                <span class="n">result_callback</span><span class="o">=</span><span class="n">result_callback</span><span class="p">,</span>
                <span class="n">context_settings</span><span class="o">=</span><span class="n">context_settings</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
                <span class="n">epilog</span><span class="o">=</span><span class="n">epilog</span><span class="p">,</span>
                <span class="n">short_help</span><span class="o">=</span><span class="n">short_help</span><span class="p">,</span>
                <span class="n">options_metavar</span><span class="o">=</span><span class="n">options_metavar</span><span class="p">,</span>
                <span class="n">add_help_option</span><span class="o">=</span><span class="n">add_help_option</span><span class="p">,</span>
                <span class="n">hidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span>
                <span class="n">deprecated</span><span class="o">=</span><span class="n">deprecated</span><span class="p">,</span>
                <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">rich_help_panel</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">TyperCommand</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">context_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">epilog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">short_help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options_metavar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;[OPTIONS]&quot;</span><span class="p">,</span>
        <span class="n">add_help_option</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">no_args_is_help</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hidden</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Rich settings</span>
        <span class="n">rich_help_panel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">CommandFunctionType</span><span class="p">],</span> <span class="n">CommandFunctionType</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">TyperCommand</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">CommandFunctionType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandFunctionType</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registered_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">CommandInfo</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span>
                    <span class="n">context_settings</span><span class="o">=</span><span class="n">context_settings</span><span class="p">,</span>
                    <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
                    <span class="n">epilog</span><span class="o">=</span><span class="n">epilog</span><span class="p">,</span>
                    <span class="n">short_help</span><span class="o">=</span><span class="n">short_help</span><span class="p">,</span>
                    <span class="n">options_metavar</span><span class="o">=</span><span class="n">options_metavar</span><span class="p">,</span>
                    <span class="n">add_help_option</span><span class="o">=</span><span class="n">add_help_option</span><span class="p">,</span>
                    <span class="n">no_args_is_help</span><span class="o">=</span><span class="n">no_args_is_help</span><span class="p">,</span>
                    <span class="n">hidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span>
                    <span class="n">deprecated</span><span class="o">=</span><span class="n">deprecated</span><span class="p">,</span>
                    <span class="c1"># Rich settings</span>
                    <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">rich_help_panel</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span> <span class="nf">add_typer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">typer_instance</span><span class="p">:</span> <span class="s2">&quot;Typer&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">TyperGroup</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">invoke_without_command</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">no_args_is_help</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">subcommand_metavar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">chain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">result_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="c1"># Command</span>
        <span class="n">context_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">epilog</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">short_help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">options_metavar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="s2">&quot;[OPTIONS]&quot;</span><span class="p">),</span>
        <span class="n">add_help_option</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">hidden</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
        <span class="c1"># Rich settings</span>
        <span class="n">rich_help_panel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Default</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">TyperInfo</span><span class="p">(</span>
                <span class="n">typer_instance</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">invoke_without_command</span><span class="o">=</span><span class="n">invoke_without_command</span><span class="p">,</span>
                <span class="n">no_args_is_help</span><span class="o">=</span><span class="n">no_args_is_help</span><span class="p">,</span>
                <span class="n">subcommand_metavar</span><span class="o">=</span><span class="n">subcommand_metavar</span><span class="p">,</span>
                <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span>
                <span class="n">result_callback</span><span class="o">=</span><span class="n">result_callback</span><span class="p">,</span>
                <span class="n">context_settings</span><span class="o">=</span><span class="n">context_settings</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
                <span class="n">epilog</span><span class="o">=</span><span class="n">epilog</span><span class="p">,</span>
                <span class="n">short_help</span><span class="o">=</span><span class="n">short_help</span><span class="p">,</span>
                <span class="n">options_metavar</span><span class="o">=</span><span class="n">options_metavar</span><span class="p">,</span>
                <span class="n">add_help_option</span><span class="o">=</span><span class="n">add_help_option</span><span class="p">,</span>
                <span class="n">hidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span>
                <span class="n">deprecated</span><span class="o">=</span><span class="n">deprecated</span><span class="p">,</span>
                <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">rich_help_panel</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">!=</span> <span class="n">except_hook</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">except_hook</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_command</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Set a custom attribute to tell the hook to show nice exceptions for user</span>
            <span class="c1"># code. An alternative/first implementation was a custom exception with</span>
            <span class="c1"># raise custom_exc from e</span>
            <span class="c1"># but that means the last error shown is the custom exception, not the</span>
            <span class="c1"># actual error. This trick improves developer experience by showing the</span>
            <span class="c1"># actual error last.</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">_typer_developer_exception_attr_name</span><span class="p">,</span>
                <span class="n">DeveloperExceptionConfig</span><span class="p">(</span>
                    <span class="n">pretty_exceptions_enable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions_enable</span><span class="p">,</span>
                    <span class="n">pretty_exceptions_show_locals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions_show_locals</span><span class="p">,</span>
                    <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>


<span class="k">def</span> <span class="nf">get_group</span><span class="p">(</span><span class="n">typer_instance</span><span class="p">:</span> <span class="n">Typer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TyperGroup</span><span class="p">:</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">get_group_from_info</span><span class="p">(</span>
        <span class="n">TyperInfo</span><span class="p">(</span><span class="n">typer_instance</span><span class="p">),</span>
        <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
        <span class="n">rich_markup_mode</span><span class="o">=</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">rich_markup_mode</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">group</span>


<span class="k">def</span> <span class="nf">get_command</span><span class="p">(</span><span class="n">typer_instance</span><span class="p">:</span> <span class="n">Typer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">click</span><span class="o">.</span><span class="n">Command</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">_add_completion</span><span class="p">:</span>
        <span class="n">click_install_param</span><span class="p">,</span> <span class="n">click_show_param</span> <span class="o">=</span> <span class="n">get_install_completion_arguments</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_callback</span>
        <span class="ow">or</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">callback</span>
        <span class="ow">or</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_groups</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_commands</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">):</span>
        <span class="c1"># Create a Group</span>
        <span class="n">click_command</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Command</span> <span class="o">=</span> <span class="n">get_group</span><span class="p">(</span><span class="n">typer_instance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">_add_completion</span><span class="p">:</span>
            <span class="n">click_command</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">click_install_param</span><span class="p">)</span>
            <span class="n">click_command</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">click_show_param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">click_command</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_commands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Create a single Command</span>
        <span class="n">single_command</span> <span class="o">=</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">single_command</span><span class="o">.</span><span class="n">context_settings</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">context_settings</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span>
        <span class="p">):</span>
            <span class="n">single_command</span><span class="o">.</span><span class="n">context_settings</span> <span class="o">=</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">context_settings</span>

        <span class="n">click_command</span> <span class="o">=</span> <span class="n">get_command_from_info</span><span class="p">(</span>
            <span class="n">single_command</span><span class="p">,</span>
            <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
            <span class="n">rich_markup_mode</span><span class="o">=</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">rich_markup_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">typer_instance</span><span class="o">.</span><span class="n">_add_completion</span><span class="p">:</span>
            <span class="n">click_command</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">click_install_param</span><span class="p">)</span>
            <span class="n">click_command</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">click_show_param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">click_command</span>
    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Could not get a command for this Typer instance&quot;</span>  <span class="c1"># pragma no cover</span>


<span class="k">def</span> <span class="nf">get_group_name</span><span class="p">(</span><span class="n">typer_info</span><span class="p">:</span> <span class="n">TyperInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
        <span class="c1"># Priority 1: Callback passed in app.add_typer()</span>
        <span class="k">return</span> <span class="n">get_command_name</span><span class="p">(</span><span class="n">typer_info</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="p">:</span>
        <span class="n">registered_callback</span> <span class="o">=</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_callback</span>
        <span class="k">if</span> <span class="n">registered_callback</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">registered_callback</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
                <span class="c1"># Priority 2: Callback passed in @subapp.callback()</span>
                <span class="k">return</span> <span class="n">get_command_name</span><span class="p">(</span><span class="n">registered_callback</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_command_name</span><span class="p">(</span><span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">solve_typer_info_help</span><span class="p">(</span><span class="n">typer_info</span><span class="p">:</span> <span class="n">TyperInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Priority 1: Explicit value was set in app.add_typer()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typer_info</span><span class="o">.</span><span class="n">help</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">typer_info</span><span class="o">.</span><span class="n">help</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># Priority 2: Explicit value was set in sub_app.callback()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">callback_help</span> <span class="o">=</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_callback</span><span class="o">.</span><span class="n">help</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback_help</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">callback_help</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># Priority 3: Explicit value was set in sub_app = typer.Typer()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">instance_help</span> <span class="o">=</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">help</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance_help</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">instance_help</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># Priority 4: Implicit inference from callback docstring in app.add_typer()</span>
    <span class="k">if</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">typer_info</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">doc</span>
    <span class="c1"># Priority 5: Implicit inference from callback docstring in @app.callback()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_callback</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">callback</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">doc</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doc</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># Priority 6: Implicit inference from callback docstring in typer.Typer()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">instance_callback</span> <span class="o">=</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance_callback</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">instance_callback</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">doc</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doc</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># Value not set, use the default</span>
    <span class="k">return</span> <span class="n">typer_info</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">solve_typer_info_defaults</span><span class="p">(</span><span class="n">typer_info</span><span class="p">:</span> <span class="n">TyperInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TyperInfo</span><span class="p">:</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">typer_info</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Priority 1: Value was set in app.add_typer()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
            <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">continue</span>
        <span class="c1"># Priority 2: Value was set in @subapp.callback()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">callback_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_callback</span><span class="p">,</span> <span class="n">name</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback_value</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
                <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">callback_value</span>
                <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Priority 3: Value set in subapp = typer.Typer()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">typer_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">name</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance_value</span><span class="p">,</span> <span class="n">DefaultPlaceholder</span><span class="p">):</span>
                <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance_value</span>
                <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Value not set, use the default</span>
        <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
    <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_group_name</span><span class="p">(</span><span class="n">typer_info</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve_typer_info_help</span><span class="p">(</span><span class="n">typer_info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TyperInfo</span><span class="p">(</span><span class="o">**</span><span class="n">values</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_group_from_info</span><span class="p">(</span>
    <span class="n">group_info</span><span class="p">:</span> <span class="n">TyperInfo</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">pretty_exceptions_short</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">rich_markup_mode</span><span class="p">:</span> <span class="n">MarkupMode</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TyperGroup</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">group_info</span><span class="o">.</span><span class="n">typer_instance</span>
    <span class="p">),</span> <span class="s2">&quot;A Typer instance is needed to generate a Click Group&quot;</span>
    <span class="n">commands</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Command</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">command_info</span> <span class="ow">in</span> <span class="n">group_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_commands</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">get_command_from_info</span><span class="p">(</span>
            <span class="n">command_info</span><span class="o">=</span><span class="n">command_info</span><span class="p">,</span>
            <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
            <span class="n">rich_markup_mode</span><span class="o">=</span><span class="n">rich_markup_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
    <span class="k">for</span> <span class="n">sub_group_info</span> <span class="ow">in</span> <span class="n">group_info</span><span class="o">.</span><span class="n">typer_instance</span><span class="o">.</span><span class="n">registered_groups</span><span class="p">:</span>
        <span class="n">sub_group</span> <span class="o">=</span> <span class="n">get_group_from_info</span><span class="p">(</span>
            <span class="n">sub_group_info</span><span class="p">,</span>
            <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
            <span class="n">rich_markup_mode</span><span class="o">=</span><span class="n">rich_markup_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">sub_group</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">commands</span><span class="p">[</span><span class="n">sub_group</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_group</span>
    <span class="n">solved_info</span> <span class="o">=</span> <span class="n">solve_typer_info_defaults</span><span class="p">(</span><span class="n">group_info</span><span class="p">)</span>
    <span class="p">(</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">convertors</span><span class="p">,</span>
        <span class="n">context_param_name</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">get_params_convertors_ctx_param_name_from_function</span><span class="p">(</span><span class="n">solved_info</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">solved_info</span><span class="o">.</span><span class="n">cls</span> <span class="ow">or</span> <span class="n">TyperGroup</span>
    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">TyperGroup</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">commands</span><span class="o">=</span><span class="n">commands</span><span class="p">,</span>
        <span class="n">invoke_without_command</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">invoke_without_command</span><span class="p">,</span>
        <span class="n">no_args_is_help</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">no_args_is_help</span><span class="p">,</span>
        <span class="n">subcommand_metavar</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">subcommand_metavar</span><span class="p">,</span>
        <span class="n">chain</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span>
        <span class="n">result_callback</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">result_callback</span><span class="p">,</span>
        <span class="n">context_settings</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">context_settings</span><span class="p">,</span>
        <span class="n">callback</span><span class="o">=</span><span class="n">get_callback</span><span class="p">(</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">convertors</span><span class="o">=</span><span class="n">convertors</span><span class="p">,</span>
            <span class="n">context_param_name</span><span class="o">=</span><span class="n">context_param_name</span><span class="p">,</span>
            <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">help</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">epilog</span><span class="p">,</span>
        <span class="n">short_help</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">short_help</span><span class="p">,</span>
        <span class="n">options_metavar</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">options_metavar</span><span class="p">,</span>
        <span class="n">add_help_option</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">add_help_option</span><span class="p">,</span>
        <span class="n">hidden</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
        <span class="n">deprecated</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span>
        <span class="n">rich_markup_mode</span><span class="o">=</span><span class="n">rich_markup_mode</span><span class="p">,</span>
        <span class="c1"># Rich settings</span>
        <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">solved_info</span><span class="o">.</span><span class="n">rich_help_panel</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">group</span>


<span class="k">def</span> <span class="nf">get_command_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_params_convertors_ctx_param_name_from_function</span><span class="p">(</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">click</span><span class="o">.</span><span class="n">Argument</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Option</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">convertors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context_param_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_params_from_function</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">):</span>
                <span class="n">context_param_name</span> <span class="o">=</span> <span class="n">param_name</span>
                <span class="k">continue</span>
            <span class="n">click_param</span><span class="p">,</span> <span class="n">convertor</span> <span class="o">=</span> <span class="n">get_click_param</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">convertor</span><span class="p">:</span>
                <span class="n">convertors</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">convertor</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">click_param</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">convertors</span><span class="p">,</span> <span class="n">context_param_name</span>


<span class="k">def</span> <span class="nf">get_command_from_info</span><span class="p">(</span>
    <span class="n">command_info</span><span class="p">:</span> <span class="n">CommandInfo</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">pretty_exceptions_short</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">rich_markup_mode</span><span class="p">:</span> <span class="n">MarkupMode</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">click</span><span class="o">.</span><span class="n">Command</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">command_info</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="s2">&quot;A command must have a callback function&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">command_info</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">get_command_name</span><span class="p">(</span><span class="n">command_info</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">use_help</span> <span class="o">=</span> <span class="n">command_info</span><span class="o">.</span><span class="n">help</span>
    <span class="k">if</span> <span class="n">use_help</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_help</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">command_info</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_help</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">use_help</span><span class="p">)</span>
    <span class="p">(</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">convertors</span><span class="p">,</span>
        <span class="n">context_param_name</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">get_params_convertors_ctx_param_name_from_function</span><span class="p">(</span><span class="n">command_info</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">command_info</span><span class="o">.</span><span class="n">cls</span> <span class="ow">or</span> <span class="n">TyperCommand</span>
    <span class="n">command</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">context_settings</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">context_settings</span><span class="p">,</span>
        <span class="n">callback</span><span class="o">=</span><span class="n">get_callback</span><span class="p">(</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">convertors</span><span class="o">=</span><span class="n">convertors</span><span class="p">,</span>
            <span class="n">context_param_name</span><span class="o">=</span><span class="n">context_param_name</span><span class="p">,</span>
            <span class="n">pretty_exceptions_short</span><span class="o">=</span><span class="n">pretty_exceptions_short</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="n">help</span><span class="o">=</span><span class="n">use_help</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">epilog</span><span class="p">,</span>
        <span class="n">short_help</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">short_help</span><span class="p">,</span>
        <span class="n">options_metavar</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">options_metavar</span><span class="p">,</span>
        <span class="n">add_help_option</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">add_help_option</span><span class="p">,</span>
        <span class="n">no_args_is_help</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">no_args_is_help</span><span class="p">,</span>
        <span class="n">hidden</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
        <span class="n">deprecated</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span>
        <span class="n">rich_markup_mode</span><span class="o">=</span><span class="n">rich_markup_mode</span><span class="p">,</span>
        <span class="c1"># Rich settings</span>
        <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">command_info</span><span class="o">.</span><span class="n">rich_help_panel</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">command</span>


<span class="k">def</span> <span class="nf">determine_type_convertor</span><span class="p">(</span><span class="n">type_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="n">convertor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">convertor</span> <span class="o">=</span> <span class="n">param_path_convertor</span>
    <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
        <span class="n">convertor</span> <span class="o">=</span> <span class="n">generate_enum_convertor</span><span class="p">(</span><span class="n">type_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">convertor</span>


<span class="k">def</span> <span class="nf">param_path_convertor</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">generate_enum_convertor</span><span class="p">(</span><span class="n">enum</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Enum</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">lower_val_map</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">enum</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">convertor</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">low</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">low</span> <span class="ow">in</span> <span class="n">lower_val_map</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">lower_val_map</span><span class="p">[</span><span class="n">low</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">enum</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">convertor</span>


<span class="k">def</span> <span class="nf">generate_list_convertor</span><span class="p">(</span>
    <span class="n">convertor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="k">def</span> <span class="nf">internal_convertor</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">convertor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">convertor</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">internal_convertor</span>


<span class="k">def</span> <span class="nf">generate_tuple_convertor</span><span class="p">(</span>
    <span class="n">types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="n">convertors</span> <span class="o">=</span> <span class="p">[</span><span class="n">determine_type_convertor</span><span class="p">(</span><span class="n">type_</span><span class="p">)</span> <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="n">types</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">internal_convertor</span><span class="p">(</span><span class="n">param_args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">convertor</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">if</span> <span class="n">convertor</span> <span class="k">else</span> <span class="n">arg</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">convertor</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">convertors</span><span class="p">,</span> <span class="n">param_args</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">internal_convertor</span>


<span class="k">def</span> <span class="nf">get_callback</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">click</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">convertors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">context_param_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pretty_exceptions_short</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">callback</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_params_from_function</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
    <span class="n">use_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="n">use_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>

    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">_rich_traceback_guard</span> <span class="o">=</span> <span class="n">pretty_exceptions_short</span>  <span class="c1"># noqa: F841</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">convertors</span><span class="p">:</span>
                <span class="n">use_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">convertors</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">context_param_name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">context_param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">click</span><span class="o">.</span><span class="n">get_current_context</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="o">**</span><span class="n">use_params</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">get_click_type</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">annotation</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">parameter_info</span><span class="p">:</span> <span class="n">ParameterInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">click</span><span class="o">.</span><span class="n">ParamType</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">annotation</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">STRING</span>
    <span class="k">elif</span> <span class="n">annotation</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">max_</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">min_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">max_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">IntRange</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">clamp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">INT</span>
    <span class="k">elif</span> <span class="n">annotation</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">FloatRange</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
                <span class="nb">max</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
                <span class="n">clamp</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">clamp</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">FLOAT</span>
    <span class="k">elif</span> <span class="n">annotation</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">BOOL</span>
    <span class="k">elif</span> <span class="n">annotation</span> <span class="o">==</span> <span class="n">UUID</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">UUID</span>
    <span class="k">elif</span> <span class="n">annotation</span> <span class="o">==</span> <span class="n">datetime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">formats</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">formats</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">annotation</span> <span class="o">==</span> <span class="n">Path</span>
        <span class="ow">or</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">allow_dash</span>
        <span class="ow">or</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">path_type</span>
        <span class="ow">or</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">resolve_path</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
            <span class="n">exists</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">exists</span><span class="p">,</span>
            <span class="n">file_okay</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">file_okay</span><span class="p">,</span>
            <span class="n">dir_okay</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">dir_okay</span><span class="p">,</span>
            <span class="n">writable</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">writable</span><span class="p">,</span>
            <span class="n">readable</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">readable</span><span class="p">,</span>
            <span class="n">resolve_path</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">resolve_path</span><span class="p">,</span>
            <span class="n">allow_dash</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">allow_dash</span><span class="p">,</span>
            <span class="n">path_type</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">path_type</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">FileTextWrite</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">mode</span> <span class="ow">or</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">lazy</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">lazy</span><span class="p">,</span>
            <span class="n">atomic</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">atomic</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">FileText</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">mode</span> <span class="ow">or</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">lazy</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">lazy</span><span class="p">,</span>
            <span class="n">atomic</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">atomic</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">FileBinaryRead</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">mode</span> <span class="ow">or</span> <span class="s2">&quot;rb&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">lazy</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">lazy</span><span class="p">,</span>
            <span class="n">atomic</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">atomic</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">FileBinaryWrite</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">mode</span> <span class="ow">or</span> <span class="s2">&quot;wb&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">errors</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">lazy</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">lazy</span><span class="p">,</span>
            <span class="n">atomic</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">atomic</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span>
            <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">],</span>
            <span class="n">case_sensitive</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">case_sensitive</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type not yet supported: </span><span class="si">{</span><span class="n">annotation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># pragma no cover</span>


<span class="k">def</span> <span class="nf">lenient_issubclass</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">class_or_tuple</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AnyType</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">AnyType</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_or_tuple</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_click_param</span><span class="p">(</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">ParamMeta</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">click</span><span class="o">.</span><span class="n">Argument</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Option</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="c1"># First, find out what will be:</span>
    <span class="c1"># * ParamInfo (ArgumentInfo or OptionInfo)</span>
    <span class="c1"># * default_value</span>
    <span class="c1"># * required</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">ParameterInfo</span><span class="p">):</span>
        <span class="n">parameter_info</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
        <span class="k">if</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">Required</span><span class="p">:</span>
            <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">default</span>
    <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">Required</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parameter_info</span> <span class="o">=</span> <span class="n">ArgumentInfo</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
        <span class="n">parameter_info</span> <span class="o">=</span> <span class="n">OptionInfo</span><span class="p">()</span>
    <span class="n">annotation</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">Any</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">annotation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">annotation</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">main_type</span> <span class="o">=</span> <span class="n">annotation</span>
    <span class="n">is_list</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_tuple</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">parameter_type</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_flag</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">main_type</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Handle Optional[SomeType]</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="n">Union</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="n">main_type</span><span class="o">.</span><span class="n">__args__</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="n">NoneType</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">type_</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Typer Currently doesn&#39;t support Union types&quot;</span>
            <span class="n">main_type</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">main_type</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Handle Tuples and Lists</span>
        <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">main_type</span> <span class="o">=</span> <span class="n">main_type</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">main_type</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;List types with complex sub-types are not currently supported&quot;</span>
            <span class="n">is_list</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="n">main_type</span><span class="o">.</span><span class="n">__args__</span><span class="p">:</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">type_</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">),</span> <span class="s2">&quot;Tuple types with complex sub-types are not currently supported&quot;</span>
                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">get_click_type</span><span class="p">(</span><span class="n">annotation</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span> <span class="n">parameter_info</span><span class="o">=</span><span class="n">parameter_info</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">parameter_type</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
            <span class="n">is_tuple</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">parameter_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parameter_type</span> <span class="o">=</span> <span class="n">get_click_type</span><span class="p">(</span>
            <span class="n">annotation</span><span class="o">=</span><span class="n">main_type</span><span class="p">,</span> <span class="n">parameter_info</span><span class="o">=</span><span class="n">parameter_info</span>
        <span class="p">)</span>
    <span class="n">convertor</span> <span class="o">=</span> <span class="n">determine_type_convertor</span><span class="p">(</span><span class="n">main_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
        <span class="n">convertor</span> <span class="o">=</span> <span class="n">generate_list_convertor</span><span class="p">(</span><span class="n">convertor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_tuple</span><span class="p">:</span>
        <span class="n">convertor</span> <span class="o">=</span> <span class="n">generate_tuple_convertor</span><span class="p">(</span><span class="n">main_type</span><span class="o">.</span><span class="n">__args__</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_info</span><span class="p">,</span> <span class="n">OptionInfo</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">main_type</span> <span class="ow">is</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">is_flag</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">is_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Click doesn&#39;t accept a flag of type bool, only None, and then it sets it</span>
            <span class="c1"># to bool internally</span>
            <span class="n">parameter_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">default_option_name</span> <span class="o">=</span> <span class="n">get_command_name</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_flag</span><span class="p">:</span>
            <span class="n">default_option_declaration</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">default_option_name</span><span class="si">}</span><span class="s2">/--no-</span><span class="si">{</span><span class="n">default_option_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_option_declaration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">default_option_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">param_decls</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">parameter_info</span><span class="o">.</span><span class="n">param_decls</span><span class="p">:</span>
            <span class="n">param_decls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">param_decls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_decls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default_option_declaration</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">TyperOption</span><span class="p">(</span>
                <span class="c1"># Option</span>
                <span class="n">param_decls</span><span class="o">=</span><span class="n">param_decls</span><span class="p">,</span>
                <span class="n">show_default</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">show_default</span><span class="p">,</span>
                <span class="n">prompt</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
                <span class="n">confirmation_prompt</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">confirmation_prompt</span><span class="p">,</span>
                <span class="n">prompt_required</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">prompt_required</span><span class="p">,</span>
                <span class="n">hide_input</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">hide_input</span><span class="p">,</span>
                <span class="n">is_flag</span><span class="o">=</span><span class="n">is_flag</span><span class="p">,</span>
                <span class="n">flag_value</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">flag_value</span><span class="p">,</span>
                <span class="n">multiple</span><span class="o">=</span><span class="n">is_list</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                <span class="n">allow_from_autoenv</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">allow_from_autoenv</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">parameter_type</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">help</span><span class="p">,</span>
                <span class="n">hidden</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
                <span class="n">show_choices</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">show_choices</span><span class="p">,</span>
                <span class="n">show_envvar</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">show_envvar</span><span class="p">,</span>
                <span class="c1"># Parameter</span>
                <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="n">get_param_callback</span><span class="p">(</span>
                    <span class="n">callback</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="n">convertor</span><span class="o">=</span><span class="n">convertor</span>
                <span class="p">),</span>
                <span class="n">metavar</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">metavar</span><span class="p">,</span>
                <span class="n">expose_value</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">expose_value</span><span class="p">,</span>
                <span class="n">is_eager</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">is_eager</span><span class="p">,</span>
                <span class="n">envvar</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">envvar</span><span class="p">,</span>
                <span class="n">shell_complete</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">shell_complete</span><span class="p">,</span>
                <span class="n">autocompletion</span><span class="o">=</span><span class="n">get_param_completion</span><span class="p">(</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">autocompletion</span><span class="p">),</span>
                <span class="c1"># Rich settings</span>
                <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">rich_help_panel</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">convertor</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_info</span><span class="p">,</span> <span class="n">ArgumentInfo</span><span class="p">):</span>
        <span class="n">param_decls</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">TyperArgument</span><span class="p">(</span>
                <span class="c1"># Argument</span>
                <span class="n">param_decls</span><span class="o">=</span><span class="n">param_decls</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">parameter_type</span><span class="p">,</span>
                <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
                <span class="n">nargs</span><span class="o">=</span><span class="n">nargs</span><span class="p">,</span>
                <span class="c1"># TyperArgument</span>
                <span class="n">show_default</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">show_default</span><span class="p">,</span>
                <span class="n">show_choices</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">show_choices</span><span class="p">,</span>
                <span class="n">show_envvar</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">show_envvar</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">help</span><span class="p">,</span>
                <span class="n">hidden</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">hidden</span><span class="p">,</span>
                <span class="c1"># Parameter</span>
                <span class="n">default</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="n">get_param_callback</span><span class="p">(</span>
                    <span class="n">callback</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="n">convertor</span><span class="o">=</span><span class="n">convertor</span>
                <span class="p">),</span>
                <span class="n">metavar</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">metavar</span><span class="p">,</span>
                <span class="n">expose_value</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">expose_value</span><span class="p">,</span>
                <span class="n">is_eager</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">is_eager</span><span class="p">,</span>
                <span class="n">envvar</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">envvar</span><span class="p">,</span>
                <span class="n">autocompletion</span><span class="o">=</span><span class="n">get_param_completion</span><span class="p">(</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">autocompletion</span><span class="p">),</span>
                <span class="c1"># Rich settings</span>
                <span class="n">rich_help_panel</span><span class="o">=</span><span class="n">parameter_info</span><span class="o">.</span><span class="n">rich_help_panel</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">convertor</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;A click.Parameter should be returned&quot;</span>  <span class="c1"># pragma no cover</span>


<span class="k">def</span> <span class="nf">get_param_callback</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">convertor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">callback</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_params_from_function</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
    <span class="n">ctx_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">click_param_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">value_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">untyped_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_sig</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">param_sig</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">):</span>
            <span class="n">ctx_name</span> <span class="o">=</span> <span class="n">param_name</span>
        <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">param_sig</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Parameter</span><span class="p">):</span>
            <span class="n">click_param_name</span> <span class="o">=</span> <span class="n">param_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">untyped_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
    <span class="c1"># Extract value param name first</span>
    <span class="k">if</span> <span class="n">untyped_names</span><span class="p">:</span>
        <span class="n">value_name</span> <span class="o">=</span> <span class="n">untyped_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="c1"># If context and Click param were not typed (old/Click callback style) extract them</span>
    <span class="k">if</span> <span class="n">untyped_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ctx_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ctx_name</span> <span class="o">=</span> <span class="n">untyped_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">click_param_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">untyped_names</span><span class="p">:</span>
                <span class="n">click_param_name</span> <span class="o">=</span> <span class="n">untyped_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">untyped_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">click</span><span class="o">.</span><span class="n">ClickException</span><span class="p">(</span>
                <span class="s2">&quot;Too many CLI parameter callback function parameters&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">use_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ctx_name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">ctx_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctx</span>
        <span class="k">if</span> <span class="n">click_param_name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">click_param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>
        <span class="k">if</span> <span class="n">value_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">convertor</span><span class="p">:</span>
                <span class="n">use_value</span> <span class="o">=</span> <span class="n">convertor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">value_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">use_value</span>
        <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="o">**</span><span class="n">use_params</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">get_param_completion</span><span class="p">(</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">callback</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_params_from_function</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
    <span class="n">ctx_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">args_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">incomplete_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">unassigned_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">param_sig</span> <span class="ow">in</span> <span class="n">unassigned_params</span><span class="p">[:]:</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">param_sig</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">param_sig</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">):</span>
            <span class="n">ctx_name</span> <span class="o">=</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span>
            <span class="n">unassigned_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param_sig</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">args_name</span> <span class="o">=</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span>
            <span class="n">unassigned_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param_sig</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">param_sig</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">incomplete_name</span> <span class="o">=</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span>
            <span class="n">unassigned_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param_sig</span><span class="p">)</span>
    <span class="c1"># If there are still unassigned parameters (not typed), extract by name</span>
    <span class="k">for</span> <span class="n">param_sig</span> <span class="ow">in</span> <span class="n">unassigned_params</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">ctx_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ctx&quot;</span><span class="p">:</span>
            <span class="n">ctx_name</span> <span class="o">=</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span>
            <span class="n">unassigned_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param_sig</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span>
            <span class="n">args_name</span> <span class="o">=</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span>
            <span class="n">unassigned_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param_sig</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">incomplete_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;incomplete&quot;</span><span class="p">:</span>
            <span class="n">incomplete_name</span> <span class="o">=</span> <span class="n">param_sig</span><span class="o">.</span><span class="n">name</span>
            <span class="n">unassigned_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param_sig</span><span class="p">)</span>
    <span class="c1"># Extract value param name first</span>
    <span class="k">if</span> <span class="n">unassigned_params</span><span class="p">:</span>
        <span class="n">show_params</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">unassigned_params</span><span class="p">])</span>
        <span class="k">raise</span> <span class="n">click</span><span class="o">.</span><span class="n">ClickException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid autocompletion callback parameters: </span><span class="si">{</span><span class="n">show_params</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">incomplete</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">use_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ctx_name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">ctx_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctx</span>
        <span class="k">if</span> <span class="n">args_name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">args_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">if</span> <span class="n">incomplete_name</span><span class="p">:</span>
            <span class="n">use_params</span><span class="p">[</span><span class="n">incomplete_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">incomplete</span>
        <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="o">**</span><span class="n">use_params</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Typer</span><span class="p">(</span><span class="n">add_completion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">command</span><span class="p">()(</span><span class="n">function</span><span class="p">)</span>
    <span class="n">app</span><span class="p">()</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019-2022, The Firebird Project.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>
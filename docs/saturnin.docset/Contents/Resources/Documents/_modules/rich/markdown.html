<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>rich.markdown &#8212; saturnin 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../../index.html">
          saturnin</a>
        <span class="navbar-text pull-left"><b>0.8.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../../usage-guide.html">Usage Guide</a></li>
                <li><a href="../../py-modindex.html">Modules</a></li>
                <li><a href="../../genindex.html">Index</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Content <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#quick-start-guide">Quick-start Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage-guide.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Saturnin Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base.html">saturnin.base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#types">Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#dataclasses">Dataclasses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-types.html">saturnin.base.types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#saturnin-common-type-definitions-and-constants">Saturnin common type definitions and constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#types-for-annotations">Types for annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#sentinels">Sentinels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-types.html#dataclasses">Dataclasses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-config.html">saturnin.base.config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-config.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-transport.html">saturnin.base.transport</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#types-for-type-hints">Types for type hints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-transport.html#channels-for-individual-0mq-socket-types">Channels for individual 0MQ socket types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-base-component.html">saturnin.base.component</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-component.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-base-component.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-controller.html">saturnin.component.controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-controller.html#constants-and-variables">Constants and variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-controller.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-controller.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-micro.html">saturnin.component.micro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-micro.html#constants-and-variables">Constants and variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-micro.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-service.html">saturnin.component.service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-service.html#constants-and-variables">Constants and variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-service.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-client.html">saturnin.component.client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-client.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-single.html">saturnin.component.single</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-single.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-bundle.html">saturnin.component.bundle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-bundle.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-registry.html">saturnin.component.registry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-registry.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-registry.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-apps.html">saturnin.component.apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-apps.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-apps.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-component-recipe.html">saturnin.component.recipe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-recipe.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-recipe.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-component-recipe.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-console.html">saturnin.lib.console</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-console.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-daemon.html">saturnin.lib.daemon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-daemon.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-metadata.html">saturnin.lib.metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-metadata.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-data-onepipe.html">saturnin.lib.data.onepipe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-onepipe.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-onepipe.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-lib-data-filter.html">saturnin.lib.data.filter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-filter.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-lib-data-filter.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-protocol-fbsp.html">saturnin.protocol.fbsp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbsp.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-protocol-fbdp.html">saturnin.protocol.fbdp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbdp.html#constants">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbdp.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-fbdp.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-protocol-iccp.html">saturnin.protocol.iccp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-iccp.html#enums">Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-protocol-iccp.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-svcrun.html">saturnin._scripts.svcrun</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-svcrun.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-daemon.html">saturnin._scripts.daemon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-daemon.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-bundlerun.html">saturnin._scripts.bundlerun</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-bundlerun.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-cli.html">saturnin._scripts.cli</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-cli.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-cli.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-repl.html">saturnin._scripts.repl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-completers.html">saturnin._scripts.completers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-site.html">saturnin._scripts.commands.site</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-site.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-site.html#command-functions">Command functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-pkg.html">saturnin._scripts.commands.pkg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-pkg.html#globals">Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref-scripts-commands-pkg.html#command-functions">Command functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-recipes.html">saturnin._scripts.commands.recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-daemons.html">saturnin._scripts.commands.daemons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref-scripts-commands-oids.html">saturnin._scripts.commands.oids</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#version-0-7-0">Version 0.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#version-0-1-0">Version 0.1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <h1>Source code for rich.markdown</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">markdown_it</span> <span class="kn">import</span> <span class="n">MarkdownIt</span>
<span class="kn">from</span> <span class="nn">markdown_it.token</span> <span class="kn">import</span> <span class="n">Token</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">box</span>
<span class="kn">from</span> <span class="nn">._loop</span> <span class="kn">import</span> <span class="n">loop_first</span>
<span class="kn">from</span> <span class="nn">._stack</span> <span class="kn">import</span> <span class="n">Stack</span>
<span class="kn">from</span> <span class="nn">.console</span> <span class="kn">import</span> <span class="n">Console</span><span class="p">,</span> <span class="n">ConsoleOptions</span><span class="p">,</span> <span class="n">JustifyMethod</span><span class="p">,</span> <span class="n">RenderResult</span>
<span class="kn">from</span> <span class="nn">.containers</span> <span class="kn">import</span> <span class="n">Renderables</span>
<span class="kn">from</span> <span class="nn">.jupyter</span> <span class="kn">import</span> <span class="n">JupyterMixin</span>
<span class="kn">from</span> <span class="nn">.panel</span> <span class="kn">import</span> <span class="n">Panel</span>
<span class="kn">from</span> <span class="nn">.rule</span> <span class="kn">import</span> <span class="n">Rule</span>
<span class="kn">from</span> <span class="nn">.segment</span> <span class="kn">import</span> <span class="n">Segment</span>
<span class="kn">from</span> <span class="nn">.style</span> <span class="kn">import</span> <span class="n">Style</span><span class="p">,</span> <span class="n">StyleStack</span>
<span class="kn">from</span> <span class="nn">.syntax</span> <span class="kn">import</span> <span class="n">Syntax</span>
<span class="kn">from</span> <span class="nn">.text</span> <span class="kn">import</span> <span class="n">Text</span><span class="p">,</span> <span class="n">TextType</span>


<span class="k">class</span> <span class="nc">MarkdownElement</span><span class="p">:</span>
    <span class="n">new_line</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MarkdownElement&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Factory to create markdown element,</span>

<span class="sd">        Args:</span>
<span class="sd">            markdown (Markdown): The parent Markdown object.</span>
<span class="sd">            token (Token): A node from markdown-it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MarkdownElement: A new markdown element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when the node is entered.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (MarkdownContext): The markdown context.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">TextType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when text is parsed.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (MarkdownContext): The markdown context.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when the parser leaves the element.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (MarkdownContext): [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_child_close</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="s2">&quot;MarkdownElement&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when a child element is closed.</span>

<span class="sd">        This method allows a parent element to take over rendering of its children.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (MarkdownContext): The markdown context.</span>
<span class="sd">            child (MarkdownElement): The child markdown element.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Return True to render the element, or False to not render the element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="s2">&quot;Console&quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="s2">&quot;ConsoleOptions&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RenderResult&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>


<span class="k">class</span> <span class="nc">UnknownElement</span><span class="p">(</span><span class="n">MarkdownElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An unknown element.</span>

<span class="sd">    Hopefully there will be no unknown elements, and we will have a MarkdownElement for</span>
<span class="sd">    everything in the document.</span>

<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">TextElement</span><span class="p">(</span><span class="n">MarkdownElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for elements that render text.&quot;&quot;&quot;</span>

    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

    <span class="k">def</span> <span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">TextType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">current_style</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">context</span><span class="o">.</span><span class="n">leave_style</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Paragraph</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Paragraph.&quot;&quot;&quot;</span>

    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;markdown.paragraph&quot;</span>
    <span class="n">justify</span><span class="p">:</span> <span class="n">JustifyMethod</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Paragraph&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">justify</span><span class="o">=</span><span class="n">markdown</span><span class="o">.</span><span class="n">justify</span> <span class="ow">or</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">justify</span><span class="p">:</span> <span class="n">JustifyMethod</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justify</span> <span class="o">=</span> <span class="n">justify</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">justify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">justify</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>


<span class="k">class</span> <span class="nc">Heading</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A heading.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Heading&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;markdown.</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="n">text</span><span class="o">.</span><span class="n">justify</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;h1&quot;</span><span class="p">:</span>
            <span class="c1"># Draw a border around h1s</span>
            <span class="k">yield</span> <span class="n">Panel</span><span class="p">(</span>
                <span class="n">text</span><span class="p">,</span>
                <span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="o">.</span><span class="n">HEAVY</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="s2">&quot;markdown.h1.border&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Styled text for h2 and beyond</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;h2&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">Text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">text</span>


<span class="k">class</span> <span class="nc">CodeBlock</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A code block with syntax highlighting.&quot;&quot;&quot;</span>

    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;markdown.code_block&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CodeBlock&quot;</span><span class="p">:</span>
        <span class="n">node_info</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">info</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">lexer_name</span> <span class="o">=</span> <span class="n">node_info</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">lexer_name</span> <span class="ow">or</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">markdown</span><span class="o">.</span><span class="n">code_theme</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">theme</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexer_name</span> <span class="o">=</span> <span class="n">lexer_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="n">theme</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span>
            <span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer_name</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="n">syntax</span>


<span class="k">class</span> <span class="nc">BlockQuote</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A block quote.&quot;&quot;&quot;</span>

    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;markdown.block_quote&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span> <span class="n">Renderables</span> <span class="o">=</span> <span class="n">Renderables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_child_close</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="s2">&quot;MarkdownElement&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">render_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">max_width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">render_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">render_options</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span>
        <span class="n">new_line</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot;▌ &quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">padding</span>
            <span class="k">yield from</span> <span class="n">line</span>
            <span class="k">yield</span> <span class="n">new_line</span>


<span class="k">class</span> <span class="nc">HorizontalRule</span><span class="p">(</span><span class="n">MarkdownElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A horizontal rule to divide sections.&quot;&quot;&quot;</span>

    <span class="n">new_line</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;markdown.hr&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Rule</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ListElement</span><span class="p">(</span><span class="n">MarkdownElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list element.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ListElement&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ListItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_type</span> <span class="o">=</span> <span class="n">list_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_start</span> <span class="o">=</span> <span class="n">list_start</span>

    <span class="k">def</span> <span class="nf">on_child_close</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="s2">&quot;MarkdownElement&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ListItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_type</span> <span class="o">==</span> <span class="s2">&quot;bullet_list_open&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="k">yield from</span> <span class="n">item</span><span class="o">.</span><span class="n">render_bullet</span><span class="p">(</span><span class="n">console</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_start</span>
            <span class="n">last_number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">item</span><span class="o">.</span><span class="n">render_number</span><span class="p">(</span>
                    <span class="n">console</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">number</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span> <span class="n">last_number</span>
                <span class="p">)</span>


<span class="k">class</span> <span class="nc">ListItem</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An item in a list.&quot;&quot;&quot;</span>

    <span class="n">style_name</span> <span class="o">=</span> <span class="s2">&quot;markdown.item&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span> <span class="n">Renderables</span> <span class="o">=</span> <span class="n">Renderables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_child_close</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="s2">&quot;MarkdownElement&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">render_bullet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">render_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">max_width</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">render_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">render_options</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
        <span class="n">bullet_style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;markdown.item.bullet&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

        <span class="n">bullet</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot; • &quot;</span><span class="p">,</span> <span class="n">bullet_style</span><span class="p">)</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">bullet_style</span><span class="p">)</span>
        <span class="n">new_line</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loop_first</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">bullet</span> <span class="k">if</span> <span class="n">first</span> <span class="k">else</span> <span class="n">padding</span>
            <span class="k">yield from</span> <span class="n">line</span>
            <span class="k">yield</span> <span class="n">new_line</span>

    <span class="k">def</span> <span class="nf">render_number</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">last_number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">number_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">last_number</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">render_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">max_width</span> <span class="o">-</span> <span class="n">number_width</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">render_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">render_options</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
        <span class="n">number_style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;markdown.item.number&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

        <span class="n">new_line</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">number_width</span><span class="p">,</span> <span class="n">number_style</span><span class="p">)</span>
        <span class="n">numeral</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">number_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">number_style</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loop_first</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">numeral</span> <span class="k">if</span> <span class="n">first</span> <span class="k">else</span> <span class="n">padding</span>
            <span class="k">yield from</span> <span class="n">line</span>
            <span class="k">yield</span> <span class="n">new_line</span>


<span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MarkdownElement&quot;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">href</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">href</span>


<span class="k">class</span> <span class="nc">ImageItem</span><span class="p">(</span><span class="n">TextElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders a placeholder for an image.&quot;&quot;&quot;</span>

    <span class="n">new_line</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">markdown</span><span class="p">:</span> <span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MarkdownElement&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Factory to create markdown element,</span>

<span class="sd">        Args:</span>
<span class="sd">            markdown (Markdown): The parent Markdown object.</span>
<span class="sd">            token (Any): A token from markdown-it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MarkdownElement: A new markdown element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span> <span class="n">markdown</span><span class="o">.</span><span class="n">hyperlinks</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hyperlinks</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperlinks</span> <span class="o">=</span> <span class="n">hyperlinks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="s2">&quot;MarkdownContext&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_style</span><span class="o">.</span><span class="n">link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_enter</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
        <span class="n">link_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">Text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperlinks</span><span class="p">:</span>
            <span class="n">title</span><span class="o">.</span><span class="n">stylize</span><span class="p">(</span><span class="n">link_style</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s2">&quot;🌆 &quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">text</span>


<span class="k">class</span> <span class="nc">MarkdownContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages the console render state.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span><span class="p">,</span>
        <span class="n">style</span><span class="p">:</span> <span class="n">Style</span><span class="p">,</span>
        <span class="n">inline_code_lexer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inline_code_theme</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;monokai&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">console</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_stack</span><span class="p">:</span> <span class="n">StyleStack</span> <span class="o">=</span> <span class="n">StyleStack</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span> <span class="n">Stack</span><span class="p">[</span><span class="n">MarkdownElement</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Syntax</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">inline_code_lexer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inline_code_lexer</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="n">inline_code_theme</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Style</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current style which is the product of all styles on the stack.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_stack</span><span class="o">.</span><span class="n">current</span>

    <span class="k">def</span> <span class="nf">on_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when the parser visits text.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node_type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;fence&quot;</span><span class="p">,</span> <span class="s2">&quot;code_inline&quot;</span><span class="p">}</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">highlight_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">highlight_text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">Text</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="n">highlight_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">style_stack</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">enter_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Style</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter a style context.&quot;&quot;&quot;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">style_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_style</span>

    <span class="k">def</span> <span class="nf">leave_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Style</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Leave a style context.&quot;&quot;&quot;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">style</span>


<span class="k">class</span> <span class="nc">Markdown</span><span class="p">(</span><span class="n">JupyterMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Markdown renderable.</span>

<span class="sd">    Args:</span>
<span class="sd">        markup (str): A string containing markdown.</span>
<span class="sd">        code_theme (str, optional): Pygments theme for code blocks. Defaults to &quot;monokai&quot;.</span>
<span class="sd">        justify (JustifyMethod, optional): Justify value for paragraphs. Defaults to None.</span>
<span class="sd">        style (Union[str, Style], optional): Optional style to apply to markdown.</span>
<span class="sd">        hyperlinks (bool, optional): Enable hyperlinks. Defaults to ``True``.</span>
<span class="sd">        inline_code_lexer: (str, optional): Lexer to use if inline code highlighting is</span>
<span class="sd">            enabled. Defaults to None.</span>
<span class="sd">        inline_code_theme: (Optional[str], optional): Pygments theme for inline code</span>
<span class="sd">            highlighting, or None for no highlighting. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">elements</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">MarkdownElement</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;paragraph_open&quot;</span><span class="p">:</span> <span class="n">Paragraph</span><span class="p">,</span>
        <span class="s2">&quot;heading_open&quot;</span><span class="p">:</span> <span class="n">Heading</span><span class="p">,</span>
        <span class="s2">&quot;fence&quot;</span><span class="p">:</span> <span class="n">CodeBlock</span><span class="p">,</span>
        <span class="s2">&quot;code_block&quot;</span><span class="p">:</span> <span class="n">CodeBlock</span><span class="p">,</span>
        <span class="s2">&quot;blockquote_open&quot;</span><span class="p">:</span> <span class="n">BlockQuote</span><span class="p">,</span>
        <span class="s2">&quot;hr&quot;</span><span class="p">:</span> <span class="n">HorizontalRule</span><span class="p">,</span>
        <span class="s2">&quot;bullet_list_open&quot;</span><span class="p">:</span> <span class="n">ListElement</span><span class="p">,</span>
        <span class="s2">&quot;ordered_list_open&quot;</span><span class="p">:</span> <span class="n">ListElement</span><span class="p">,</span>
        <span class="s2">&quot;list_item_open&quot;</span><span class="p">:</span> <span class="n">ListItem</span><span class="p">,</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">ImageItem</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">inlines</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;em&quot;</span><span class="p">,</span> <span class="s2">&quot;strong&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">markup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">code_theme</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;monokai&quot;</span><span class="p">,</span>
        <span class="n">justify</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JustifyMethod</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">style</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">hyperlinks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">inline_code_lexer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inline_code_theme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">MarkdownIt</span><span class="p">()</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s2">&quot;strikethrough&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parsed</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_theme</span> <span class="o">=</span> <span class="n">code_theme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justify</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JustifyMethod</span><span class="p">]</span> <span class="o">=</span> <span class="n">justify</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperlinks</span> <span class="o">=</span> <span class="n">hyperlinks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_code_lexer</span> <span class="o">=</span> <span class="n">inline_code_lexer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_code_theme</span> <span class="o">=</span> <span class="n">inline_code_theme</span> <span class="ow">or</span> <span class="n">code_theme</span>

    <span class="k">def</span> <span class="nf">_flatten_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Token</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flattens the token stream.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">is_fence</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;fence&quot;</span>
            <span class="n">is_image</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;img&quot;</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">children</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">is_image</span> <span class="ow">or</span> <span class="n">is_fence</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_tokens</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">token</span>

    <span class="k">def</span> <span class="nf">__rich_console__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ConsoleOptions</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RenderResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render markdown to the console.&quot;&quot;&quot;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">MarkdownContext</span><span class="p">(</span>
            <span class="n">console</span><span class="p">,</span>
            <span class="n">options</span><span class="p">,</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">inline_code_lexer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inline_code_lexer</span><span class="p">,</span>
            <span class="n">inline_code_theme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inline_code_theme</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsed</span>
        <span class="n">inline_style_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inlines</span>
        <span class="n">new_line</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_new_line_segment</span> <span class="o">=</span> <span class="n">Segment</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_tokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="n">node_type</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">tag</span>

            <span class="n">entering</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">nesting</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">exiting</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">nesting</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">self_closing</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">nesting</span> <span class="o">==</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;hardbreak&quot;</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;softbreak&quot;</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;link_open&quot;</span><span class="p">:</span>
                <span class="n">href</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperlinks</span><span class="p">:</span>
                    <span class="n">link_style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;markdown.link_url&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
                    <span class="n">link_style</span> <span class="o">+=</span> <span class="n">Style</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="n">href</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="n">link_style</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;link_close&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperlinks</span><span class="p">:</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">leave_style</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Link</span><span class="p">)</span>
                    <span class="n">link_style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;markdown.link&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="n">link_style</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">plain</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">leave_style</span><span class="p">()</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="s2">&quot; (&quot;</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
                    <span class="n">link_url_style</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span>
                        <span class="s2">&quot;markdown.link_url&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
                    <span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="n">link_url_style</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">leave_style</span><span class="p">()</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">tag</span> <span class="ow">in</span> <span class="n">inline_style_tags</span>
                <span class="ow">and</span> <span class="n">node_type</span> <span class="o">!=</span> <span class="s2">&quot;fence&quot;</span>
                <span class="ow">and</span> <span class="n">node_type</span> <span class="o">!=</span> <span class="s2">&quot;code_block&quot;</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">entering</span><span class="p">:</span>
                    <span class="c1"># If it&#39;s an opening inline token e.g. strong, em, etc.</span>
                    <span class="c1"># Then we move into a style context i.e. push to stack.</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;markdown.</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">exiting</span><span class="p">:</span>
                    <span class="c1"># If it&#39;s a closing inline style, then we pop the style</span>
                    <span class="c1"># off of the stack, to move out of the context of it...</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">leave_style</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If it&#39;s a self-closing inline style e.g. `code_inline`</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">enter_style</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;markdown.</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">leave_style</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Map the markdown tag -&gt; MarkdownElement renderable</span>
                <span class="n">element_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="ow">or</span> <span class="n">UnknownElement</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">element_class</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">entering</span> <span class="ow">or</span> <span class="n">self_closing</span><span class="p">:</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">on_enter</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exiting</span><span class="p">:</span>  <span class="c1"># CLOSING tag</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                    <span class="n">should_render</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">stack</span>
                        <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">on_child_close</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">should_render</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">new_line</span><span class="p">:</span>
                            <span class="k">yield</span> <span class="n">_new_line_segment</span>
                        <span class="k">yield from</span> <span class="n">console</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">self_closing</span><span class="p">:</span>  <span class="c1"># SELF-CLOSING tags (e.g. text, code, image)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">content</span>
                    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">element</span><span class="o">.</span><span class="n">on_text</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

                    <span class="n">should_render</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span>
                        <span class="ow">or</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span>
                        <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">on_child_close</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">should_render</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">new_line</span><span class="p">:</span>
                            <span class="k">yield</span> <span class="n">_new_line_segment</span>
                        <span class="k">yield from</span> <span class="n">console</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exiting</span> <span class="ow">or</span> <span class="n">self_closing</span><span class="p">:</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">on_leave</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                    <span class="n">new_line</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">new_line</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>

    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Render Markdown to the console with Rich&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;path&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PATH&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;path to markdown file, or - for stdin&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--force-color&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;force_color&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force color for non-terminals&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--code-theme&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;code_theme&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;monokai&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;pygments code theme&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--inline-code-lexer&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;inline_code_lexer&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;inline_code_lexer&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-y&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--hyperlinks&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;hyperlinks&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;enable hyperlinks&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--width&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;width of output (default will auto-detect)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-j&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--justify&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;justify&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;enable full text justify&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--page&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use pager to scroll output&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
        <span class="n">markdown_body</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">markdown_file</span><span class="p">:</span>
            <span class="n">markdown_body</span> <span class="o">=</span> <span class="n">markdown_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">markdown</span> <span class="o">=</span> <span class="n">Markdown</span><span class="p">(</span>
        <span class="n">markdown_body</span><span class="p">,</span>
        <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;full&quot;</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">justify</span> <span class="k">else</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">code_theme</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">code_theme</span><span class="p">,</span>
        <span class="n">hyperlinks</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">hyperlinks</span><span class="p">,</span>
        <span class="n">inline_code_lexer</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">inline_code_lexer</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">page</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">io</span>
        <span class="kn">import</span> <span class="nn">pydoc</span>

        <span class="n">fileio</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">(</span>
            <span class="n">file</span><span class="o">=</span><span class="n">fileio</span><span class="p">,</span> <span class="n">force_terminal</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">width</span>
        <span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
        <span class="n">pydoc</span><span class="o">.</span><span class="n">pager</span><span class="p">(</span><span class="n">fileio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">(</span>
            <span class="n">force_terminal</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019-2022, The Firebird Project.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>